<project>

    <property name="antjars.dir" value="${basedir}/antjars/" />

    <path id="antjars.classpath">
        <fileset dir="${antjars.dir}">
            <include name="*.jar" />
        </fileset>
    </path>

    <taskdef classpathref="antjars.classpath" resource="tasks.properties" />

    <target name="init">
        <property file="cobertura.properties"/>
        <property name="src.dir" location="${basedir}/sources"/>
        <property name="cobertura.dir" location="${basedir}/cobertura"/>
        <property name="merge.dir" location="${basedir}/merges"/>
        <property name="merged.ser" location="${merge.dir}/cobertura.ser"/>
        <property name="coveragereport.dir" location="${basedir}/report"/>

        <echoproperties>
            <propertyset>
                <propertyref prefix="coveragereport"/>
                <propertyref prefix="cobertura"/>
                <propertyref prefix="merge"/>
                <propertyref prefix="src.dir"/>
            </propertyset>
        </echoproperties>
    </target>

    <target name="create-merged-sers"
            depends="init">

        <cobertura-merge datafile="${merged.ser}">
            <fileset dir="${cobertura.dir}">
                <include name="*-cobertura.ser" />
            </fileset>
            <fileset file="${cobertura.ser.file}"/>
        </cobertura-merge>
    </target>

    <target name="create-report"
            description="Generate an html coverage report using the contents of the cobertura.ser file.  Performs clean first."
            depends="init, clean, create-merged-sers">


        <cobertura-report
                format="html"
                destdir="${coveragereport.dir}"
                datafile="${merged.ser}">
            <fileset dir="${src.dir}/website-core">
                <include name="**/*.java" />
            </fileset>
            <fileset dir="${src.dir}/core">
                <include name="**/*.java" />
            </fileset>
        </cobertura-report>
    </target>

    <target name="clean-tomcat-data"
            description="Delete the cobertura.ser file created by tomcat"
            depends="init">
        <delete file="${cobertura.ser.file}"/>
    </target>

    <target name="clean"
            description="clean local build artifacts.  Leaves tomcat cobertura.ser file alone."
            depends="clean-report, clean-merges"/>

    <target name="clean-report"
            description="Delete the html reports"
            depends="init">
        <delete dir="${coveragereport.dir}"/>
    </target>

    <target name="clean-merges"
            description="Delete the merged cobertura.ser file"
            depends="init">
        <delete dir="${merge.dir}"/>
    </target>
</project>